---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan:dev
    commands:
      - njsscan src     

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: 69bfemLk1u/5G2yEvDOtvJh6ic3G+JdRdME8WXtrkwaAWhiMjFRg9XR3qUg9PSJJMn+35NfFejj/818vDI7xhw==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 7ecedf150920b5b75db72e3cde027641d9bb348677e84c46099ff6a5d65c6a2c

...
